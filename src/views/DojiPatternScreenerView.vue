<template>
  <div class="doji-pattern-screener-view">
    <div class="page-header">
      <div class="header-content">
        <h1>åå­—æ˜Ÿå½¢æ€ç­›é€‰å·¥å…·</h1>
        <p class="page-description">ç­›é€‰å‡ºç°åå­—æ˜Ÿå½¢æ€åä¸Šæ¶¨çš„è‚¡ç¥¨ï¼Œå¸®åŠ©æ‚¨å‘ç°æ½œåœ¨çš„äº¤æ˜“æœºä¼š</p>
      </div>
      <div class="header-actions">
        <el-button type="primary" @click="showGuide">
          <el-icon><QuestionFilled /></el-icon>
          åŠŸèƒ½æŒ‡å—
        </el-button>
      </div>
    </div>

    <!-- åŠŸèƒ½æŒ‡å—ç»„ä»¶ -->
    <doji-pattern-feature-guide v-if="guideVisible" @close="guideVisible = false" />

    <el-row :gutter="20">
      <el-col :span="24">
        <el-card class="feature-intro-card">
          <div class="feature-intro">
            <div class="intro-icon">âœ¨</div>
            <div class="intro-content">
              <h3>ä»€ä¹ˆæ˜¯åå­—æ˜Ÿå½¢æ€ï¼Ÿ</h3>
              <p>
                åå­—æ˜Ÿæ˜¯ä¸€ç§é‡è¦çš„Kçº¿å½¢æ€ï¼Œå…¶å¼€ç›˜ä»·å’Œæ”¶ç›˜ä»·å‡ ä¹ç›¸åŒï¼Œå½¢æˆä¸€ä¸ªåå­—å½¢çŠ¶ã€‚åœ¨æŠ€æœ¯åˆ†æä¸­ï¼Œåå­—æ˜Ÿé€šå¸¸è¢«è§†ä¸ºå¸‚åœºçŠ¹è±«æˆ–æ½œåœ¨åè½¬çš„ä¿¡å·ã€‚
              </p>
              <p>ä½¿ç”¨æœ¬å·¥å…·ï¼Œæ‚¨å¯ä»¥ç­›é€‰å‡ºæœ€è¿‘å‡ºç°åå­—æ˜Ÿå½¢æ€åä¸Šæ¶¨çš„è‚¡ç¥¨ï¼ŒæŠŠæ¡æ½œåœ¨çš„äº¤æ˜“æœºä¼šã€‚</p>
              <div class="intro-actions">
                <el-button type="primary" @click="scrollToScreener">å¼€å§‹ç­›é€‰</el-button>
                <el-button @click="showTutorial">æŸ¥çœ‹æ•™ç¨‹</el-button>
              </div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <div class="section-divider">
      <span>ç­›é€‰å·¥å…·</span>
    </div>

    <div ref="screenerRef">
      <doji-pattern-screener-component />
    </div>

    <div class="section-divider">
      <span>ç›¸å…³åŠŸèƒ½</span>
    </div>

    <el-row :gutter="20">
      <el-col :md="8" :sm="12">
        <el-card class="related-feature-card" shadow="hover">
          <div class="related-feature">
            <div class="feature-icon">âš™ï¸</div>
            <div class="feature-content">
              <h3>åå­—æ˜Ÿè®¾ç½®</h3>
              <p>è‡ªå®šä¹‰åå­—æ˜Ÿè¯†åˆ«å‚æ•°ï¼Œè°ƒæ•´æ•æ„Ÿåº¦å’Œæ˜¾ç¤ºé€‰é¡¹</p>
              <el-button type="info" @click="goToSettings">å‰å¾€è®¾ç½®</el-button>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :md="8" :sm="12">
        <el-card class="related-feature-card" shadow="hover">
          <div class="related-feature">
            <div class="feature-icon">ğŸ”§</div>
            <div class="feature-content">
              <h3>ç³»ç»Ÿç®¡ç†</h3>
              <p>ç®¡ç†åå­—æ˜Ÿå½¢æ€ç³»ç»Ÿæ€§èƒ½ã€ç¼“å­˜å’Œé…ç½®</p>
              <el-button type="warning" @click="goToSystem">ç³»ç»Ÿç®¡ç†</el-button>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :md="8" :sm="12">
        <el-card class="related-feature-card" shadow="hover">
          <div class="related-feature">
            <div class="feature-icon">ğŸ””</div>
            <div class="feature-content">
              <h3>åå­—æ˜Ÿæé†’</h3>
              <p>è®¾ç½®åå­—æ˜Ÿå½¢æ€å‡ºç°æ—¶çš„è‡ªåŠ¨æé†’ï¼Œä¸é”™è¿‡äº¤æ˜“æœºä¼š</p>
              <el-button type="success" @click="goToAlerts">è®¾ç½®æé†’</el-button>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :md="8" :sm="12">
        <el-card class="related-feature-card" shadow="hover">
          <div class="related-feature">
            <div class="feature-icon">ğŸ“Š</div>
            <div class="feature-content">
              <h3>Kçº¿å›¾åˆ†æ</h3>
              <p>åœ¨Kçº¿å›¾ä¸ŠæŸ¥çœ‹åå­—æ˜Ÿå½¢æ€æ ‡è®°å’Œè¯¦ç»†åˆ†æ</p>
              <el-button @click="goToStockAnalysis">æŸ¥çœ‹Kçº¿å›¾</el-button>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>

    <!-- æ•™ç¨‹å¼¹çª— -->
    <el-dialog v-model="tutorialVisible" title="åå­—æ˜Ÿå½¢æ€ç­›é€‰å·¥å…·ä½¿ç”¨æ•™ç¨‹" width="70%">
      <div class="tutorial-content">
        <h3>1. è®¾ç½®ç­›é€‰æ¡ä»¶</h3>
        <p>åœ¨ç­›é€‰æ¡ä»¶è¡¨å•ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦ç­›é€‰çš„åå­—æ˜Ÿå½¢æ€ç±»å‹ã€æ—¶é—´èŒƒå›´ã€æœ€å°ä¸Šæ¶¨å¹…åº¦ç­‰æ¡ä»¶ã€‚</p>
        <el-divider />

        <h3>2. æ‰§è¡Œç­›é€‰</h3>
        <p>ç‚¹å‡»"å¼€å§‹ç­›é€‰"æŒ‰é’®ï¼Œç³»ç»Ÿå°†æ ¹æ®æ‚¨è®¾ç½®çš„æ¡ä»¶æŸ¥æ‰¾ç¬¦åˆè¦æ±‚çš„è‚¡ç¥¨ã€‚</p>
        <el-divider />

        <h3>3. æŸ¥çœ‹ç»“æœ</h3>
        <p>
          ç­›é€‰ç»“æœå°†æ˜¾ç¤ºåœ¨ä¸‹æ–¹çš„è¡¨æ ¼ä¸­ï¼ŒåŒ…æ‹¬è‚¡ç¥¨ä»£ç ã€åç§°ã€å½¢æ€ç±»å‹ã€å½¢æ€æ—¥æœŸã€ä»·æ ¼å˜åŒ–ç­‰ä¿¡æ¯ã€‚
        </p>
        <el-divider />

        <h3>4. åˆ†æç»“æœ</h3>
        <p>ç‚¹å‡»"æ˜¾ç¤ºåˆ†æ"æŒ‰é’®ï¼Œå¯ä»¥æŸ¥çœ‹ç­›é€‰ç»“æœçš„ç»Ÿè®¡åˆ†æï¼ŒåŒ…æ‹¬å½¢æ€åˆ†å¸ƒã€ä¸Šæ¶¨å¹…åº¦åˆ†å¸ƒç­‰å›¾è¡¨ã€‚</p>
        <el-divider />

        <h3>5. æŸ¥çœ‹è¯¦æƒ…</h3>
        <p>ç‚¹å‡»ç»“æœè¡¨æ ¼ä¸­çš„"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®ï¼Œå¯ä»¥æŸ¥çœ‹è¯¥è‚¡ç¥¨çš„åå­—æ˜Ÿå½¢æ€è¯¦ç»†ä¿¡æ¯å’Œåç»­ä»·æ ¼èµ°åŠ¿ã€‚</p>
        <el-divider />

        <h3>6. å¯¼å‡ºç»“æœ</h3>
        <p>ç‚¹å‡»"å¯¼å‡ºç»“æœ"æŒ‰é’®ï¼Œå¯ä»¥å°†ç­›é€‰ç»“æœå¯¼å‡ºä¸ºCSVã€Excelæˆ–JSONæ ¼å¼ã€‚</p>
      </div>
    </el-dialog>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { QuestionFilled } from '@element-plus/icons-vue'
import DojiPatternScreenerComponent from '@/components/technical-analysis/DojiPatternScreenerView.vue'
import DojiPatternFeatureGuide from '@/components/common/DojiPatternFeatureGuide.vue'

const router = useRouter()
const screenerRef = ref<HTMLElement | null>(null)
const tutorialVisible = ref(false)
const guideVisible = ref(false)

// æ£€æŸ¥æ˜¯å¦æ˜¯é¦–æ¬¡è®¿é—®
onMounted(() => {
  // å¦‚æœæ˜¯é¦–æ¬¡è®¿é—®è¯¥é¡µé¢ï¼Œæ˜¾ç¤ºåŠŸèƒ½æŒ‡å—
  const hasVisitedBefore = localStorage.getItem('dojiPatternScreenerVisited')
  if (!hasVisitedBefore) {
    guideVisible.value = true
    localStorage.setItem('dojiPatternScreenerVisited', 'true')
  }
})

// æ»šåŠ¨åˆ°ç­›é€‰å™¨
const scrollToScreener = () => {
  screenerRef.value?.scrollIntoView({ behavior: 'smooth' })
}

// æ˜¾ç¤ºæ•™ç¨‹
const showTutorial = () => {
  tutorialVisible.value = true
}

// æ˜¾ç¤ºåŠŸèƒ½æŒ‡å—
const showGuide = () => {
  guideVisible.value = true
}

// å¯¼èˆªåˆ°åå­—æ˜Ÿè®¾ç½®é¡µé¢
const goToSettings = () => {
  router.push('/doji-pattern/settings')
}

// å¯¼èˆªåˆ°åå­—æ˜Ÿæé†’é¡µé¢
const goToAlerts = () => {
  router.push('/doji-pattern/alerts')
}

// å¯¼èˆªåˆ°è‚¡ç¥¨åˆ†æé¡µé¢
const goToStockAnalysis = () => {
  router.push('/stock')
}

// å¯¼èˆªåˆ°ç³»ç»Ÿç®¡ç†é¡µé¢
const goToSystem = () => {
  router.push('/doji-pattern/system')
}
</script>

<style scoped>
.doji-pattern-screener-view {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.page-header {
  margin-bottom: 24px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
}

.header-content {
  flex: 1;
}

.header-actions {
  margin-left: 20px;
}

.page-description {
  color: var(--text-secondary);
  font-size: 16px;
  max-width: 800px;
}

.feature-intro-card {
  margin-bottom: 30px;
}

.feature-intro {
  display: flex;
  gap: 20px;
}

.intro-icon {
  font-size: 48px;
  color: var(--primary-color);
}

.intro-content {
  flex: 1;
}

.intro-content h3 {
  margin-top: 0;
  margin-bottom: 16px;
  font-size: 20px;
}

.intro-actions {
  margin-top: 20px;
}

.section-divider {
  display: flex;
  align-items: center;
  margin: 40px 0 20px;
}

.section-divider::before,
.section-divider::after {
  content: '';
  flex: 1;
  border-bottom: 1px solid var(--border-light);
}

.section-divider span {
  padding: 0 16px;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-secondary);
}

.related-feature-card {
  height: 100%;
  transition: transform 0.3s ease;
}

.related-feature-card:hover {
  transform: translateY(-5px);
}

.related-feature {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 10px;
}

.feature-icon {
  font-size: 36px;
  margin-bottom: 16px;
}

.feature-content h3 {
  margin-top: 0;
  margin-bottom: 10px;
}

.feature-content p {
  margin-bottom: 20px;
  color: var(--text-secondary);
}

.tutorial-content h3 {
  color: var(--primary-color);
  margin-top: 20px;
}

.tutorial-content p {
  margin-bottom: 20px;
}

@media (max-width: 768px) {
  .feature-intro {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .related-feature-card {
    margin-bottom: 20px;
  }
}
</style>
