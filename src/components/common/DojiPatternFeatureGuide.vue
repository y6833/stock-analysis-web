<template>
  <div class="doji-pattern-feature-guide">
    <el-card class="guide-card">
      <template #header>
        <div class="card-header">
          <span class="header-icon">ğŸ“š</span>
          <span class="header-title">åå­—æ˜Ÿå½¢æ€åŠŸèƒ½æŒ‡å—</span>
          <el-button type="text" @click="closeGuide" class="close-button">
            <el-icon><Close /></el-icon>
          </el-button>
        </div>
      </template>

      <div class="guide-content">
        <el-steps :active="activeStep" finish-status="success" simple>
          <el-step title="ç­›é€‰å·¥å…·" icon="Search" @click="setStep(0)" />
          <el-step title="è®¾ç½®å‚æ•°" icon="Setting" @click="setStep(1)" />
          <el-step title="åˆ›å»ºæé†’" icon="Bell" @click="setStep(2)" />
          <el-step title="æŸ¥çœ‹åˆ†æ" icon="DataAnalysis" @click="setStep(3)" />
        </el-steps>

        <div class="step-content">
          <div v-if="activeStep === 0" class="step-details">
            <h3>åå­—æ˜Ÿç­›é€‰å·¥å…·</h3>
            <p>
              ä½¿ç”¨åå­—æ˜Ÿç­›é€‰å·¥å…·ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿæ‰¾åˆ°æœ€è¿‘å‡ºç°åå­—æ˜Ÿå½¢æ€åä¸Šæ¶¨çš„è‚¡ç¥¨ï¼ŒæŠŠæ¡æ½œåœ¨çš„äº¤æ˜“æœºä¼šã€‚
            </p>
            <div class="feature-image">
              <img
                src="@/image/guide/doji-screener.png"
                alt="åå­—æ˜Ÿç­›é€‰å·¥å…·"
                class="placeholder-image"
              />
            </div>
            <div class="step-actions">
              <el-button type="primary" @click="goToScreener">å‰å¾€ç­›é€‰å·¥å…·</el-button>
              <el-button @click="nextStep">ä¸‹ä¸€æ­¥</el-button>
            </div>
          </div>

          <div v-if="activeStep === 1" class="step-details">
            <h3>è‡ªå®šä¹‰åå­—æ˜Ÿå‚æ•°</h3>
            <p>åœ¨è®¾ç½®é¡µé¢ï¼Œæ‚¨å¯ä»¥è°ƒæ•´åå­—æ˜Ÿè¯†åˆ«çš„æ•æ„Ÿåº¦å‚æ•°ï¼Œè‡ªå®šä¹‰ä¸åŒç±»å‹åå­—æ˜Ÿçš„è¯†åˆ«æ ‡å‡†ã€‚</p>
            <div class="feature-image">
              <img
                src="@/image/guide/doji-settings.png"
                alt="åå­—æ˜Ÿè®¾ç½®"
                class="placeholder-image"
              />
            </div>
            <div class="step-actions">
              <el-button type="primary" @click="goToSettings">å‰å¾€è®¾ç½®</el-button>
              <el-button @click="prevStep">ä¸Šä¸€æ­¥</el-button>
              <el-button @click="nextStep">ä¸‹ä¸€æ­¥</el-button>
            </div>
          </div>

          <div v-if="activeStep === 2" class="step-details">
            <h3>è®¾ç½®åå­—æ˜Ÿæé†’</h3>
            <p>
              åˆ›å»ºåŸºäºåå­—æ˜Ÿå½¢æ€çš„æ¡ä»¶æé†’ï¼Œå½“æ‚¨å…³æ³¨çš„è‚¡ç¥¨å‡ºç°æŒ‡å®šç±»å‹çš„åå­—æ˜Ÿå½¢æ€æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨é€šçŸ¥æ‚¨ã€‚
            </p>
            <div class="feature-image">
              <img src="@/image/guide/doji-alerts.png" alt="åå­—æ˜Ÿæé†’" class="placeholder-image" />
            </div>
            <div class="step-actions">
              <el-button type="primary" @click="goToAlerts">åˆ›å»ºæé†’</el-button>
              <el-button @click="prevStep">ä¸Šä¸€æ­¥</el-button>
              <el-button @click="nextStep">ä¸‹ä¸€æ­¥</el-button>
            </div>
          </div>

          <div v-if="activeStep === 3" class="step-details">
            <h3>æŸ¥çœ‹å½¢æ€åˆ†æ</h3>
            <p>åˆ†æåå­—æ˜Ÿå½¢æ€åçš„ä»·æ ¼èµ°åŠ¿æ¨¡å¼ï¼Œäº†è§£ä¸åŒç±»å‹åå­—æ˜Ÿåœ¨å„ç§å¸‚åœºç¯å¢ƒä¸‹çš„æˆåŠŸç‡ã€‚</p>
            <div class="feature-image">
              <img
                src="@/image/guide/doji-analysis.png"
                alt="åå­—æ˜Ÿåˆ†æ"
                class="placeholder-image"
              />
            </div>
            <div class="step-actions">
              <el-button type="primary" @click="goToScreener">æŸ¥çœ‹åˆ†æ</el-button>
              <el-button @click="prevStep">ä¸Šä¸€æ­¥</el-button>
              <el-button type="success" @click="finishGuide">å®ŒæˆæŒ‡å—</el-button>
            </div>
          </div>
        </div>
      </div>
    </el-card>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { Close, Search, Setting, Bell, DataAnalysis } from '@element-plus/icons-vue'

const router = useRouter()
const activeStep = ref(0)
const emit = defineEmits(['close'])

// è®¾ç½®å½“å‰æ­¥éª¤
const setStep = (step: number) => {
  activeStep.value = step
}

// ä¸‹ä¸€æ­¥
const nextStep = () => {
  if (activeStep.value < 3) {
    activeStep.value++
  }
}

// ä¸Šä¸€æ­¥
const prevStep = () => {
  if (activeStep.value > 0) {
    activeStep.value--
  }
}

// å…³é—­æŒ‡å—
const closeGuide = () => {
  emit('close')
}

// å®ŒæˆæŒ‡å—
const finishGuide = () => {
  // å¯ä»¥åœ¨è¿™é‡Œè®°å½•ç”¨æˆ·å·²å®ŒæˆæŒ‡å—
  localStorage.setItem('dojiPatternGuideCompleted', 'true')
  emit('close')
}

// å¯¼èˆªåˆ°åå­—æ˜Ÿç­›é€‰å·¥å…·
const goToScreener = () => {
  router.push('/doji-pattern/screener')
}

// å¯¼èˆªåˆ°åå­—æ˜Ÿè®¾ç½®é¡µé¢
const goToSettings = () => {
  router.push('/doji-pattern/settings')
}

// å¯¼èˆªåˆ°åå­—æ˜Ÿæé†’é¡µé¢
const goToAlerts = () => {
  router.push('/doji-pattern/alerts')
}
</script>

<style scoped>
.guide-card {
  border-radius: 8px;
  box-shadow: var(--shadow-md);
  margin-bottom: 20px;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 8px;
}

.header-icon {
  font-size: 18px;
}

.header-title {
  font-weight: 600;
  font-size: 16px;
  flex: 1;
}

.close-button {
  padding: 2px;
}

.guide-content {
  padding: 10px 0;
}

.step-content {
  margin-top: 20px;
  padding: 10px;
  border-radius: 8px;
  background-color: var(--bg-secondary);
}

.step-details {
  padding: 10px;
}

.step-details h3 {
  margin-top: 0;
  color: var(--primary-color);
}

.feature-image {
  margin: 15px 0;
  text-align: center;
  background-color: #f5f7fa;
  padding: 20px;
  border-radius: 8px;
}

.placeholder-image {
  max-width: 100%;
  height: 200px;
  object-fit: contain;
  opacity: 0.7;
}

.step-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 15px;
}
</style>
